<main class="main-content-quiz">
  
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  
  <h1 class="page-title-center">Ajouter un nouveau quiz</h1>

  <div class="form-card">
    
    <!-- SÉLECTION CONTE -->
    <div class="section-group">
      <label class="section-label">Contes</label>
      <div class="custom-select-wrapper">
        <select class="input-rounded" [(ngModel)]="selectedConteId">
          <option [ngValue]="null" disabled selected>-- Choisir un conte --</option>
          <option *ngFor="let c of contes" [ngValue]="c.id">{{ c.titre }}</option>
        </select>
      </div>
    </div>

    <!-- TITRE QUIZ -->
    <div class="section-group">
      <label class="section-label">Titre du Quiz</label>
      <input type="text" class="input-rounded" [(ngModel)]="currentQuiz.titre" placeholder="Ex: Quiz sur le Lion">
    </div>

    <!-- BOUCLE DES QUESTIONS -->
    <div *ngFor="let question of currentQuiz.questions; let i = index" class="question-block">
      
      <div class="question-header">
        <!-- NOUVEAU : Conteneur gauche pour Titre + Points -->
        <div class="header-left">
            <label class="section-label" style="margin-bottom: 0;">Questions {{ i + 1 }}</label>
            
            <!-- Petit encart pour les points -->
            <div class="points-badge">
                <span class="points-label">Points :</span>
                <input type="number" class="input-rounded input-small" [(ngModel)]="question.points" min="1">
            </div>
        </div>

        <button *ngIf="currentQuiz.questions.length > 1" class="btn-trash" style="border:none" (click)="removeQuestion(i)">
          <i class="material-icons">close</i>
        </button>
      </div>

      <input type="text" 
             class="input-rounded" 
             style="font-style: italic;" 
             [(ngModel)]="question.texteQuestion" 
             placeholder="Ex: L'histoire du lion et du chasseur?">

      <!-- TOGGLE QCM vs VRAI/FAUX -->
      <div class="toggle-container">
        
        <div class="toggle-option" 
             [class.active]="question.typeReponse === 'QCM'"
             (click)="setQuestionType('QCM', question)">
          <span class="toggle-label">QCM</span>
          <div class="toggle-circle"></div>
        </div>

        <div class="toggle-option" 
             [class.active]="question.typeReponse === 'VRAI_FAUX'"
             (click)="setQuestionType('VRAI_FAUX', question)">
          <span class="toggle-label">Vrai/Faux</span>
          <div class="toggle-circle"></div>
        </div>

      </div>

      <!-- LISTE DES PROPOSITIONS -->
      <div class="propositions-list">
        
        <div *ngFor="let prop of question.propositions; let j = index" class="proposition-row">
          
          <input type="text" 
                 class="input-rounded prop-input" 
                 [(ngModel)]="prop.texteProposition" 
                 [readonly]="question.typeReponse === 'VRAI_FAUX'"
                 [placeholder]="'Réponse ' + (j + 1)">

          <div class="check-circle" 
               [class.checked]="prop.estCorrecte"
               (click)="toggleCorrect(question, prop)"
               title="Marquer comme bonne réponse">
          </div>

          <button class="btn-trash" 
                  *ngIf="question.typeReponse === 'QCM'"
                  (click)="removeProposition(question, j)">
            <i class="material-icons">delete_outline</i>
          </button>

        </div>

      </div>

      <!-- BOUTONS ACTIONS -->
      <div class="actions-row">
        <button class="btn-pill btn-gold" (click)="addQuestion()" *ngIf="i === currentQuiz.questions.length - 1">
          Ajouter une question
        </button>
        
        <button class="btn-pill btn-green" (click)="addProposition(question)" *ngIf="question.typeReponse === 'QCM'">
          Ajouter une réponse
        </button>
      </div>

    </div> 

    <!-- VALIDATION FINALE -->
    <div class="form-footer">
      <button class="btn-validate-big" (click)="validateQuiz()">Valider</button>
    </div>

  </div>

</main>