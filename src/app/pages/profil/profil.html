<div class="page-wrapper">
    
    <header class="profile-header">
        <h1 class="header-title">Profil Administrateur</h1>
    </header>

    <!-- Message de feedback -->
    <div *ngIf="message" class="alert-message" [ngClass]="message.includes('Erreur') ? 'error' : 'success'">
        {{ message }}
    </div>

    <div class="profile-content-container" *ngIf="profil">
        <!-- Carte Gauche : Résumé -->
        <div class="user-card">
            <div class="user-icon-bg">
                <i class="material-icons user-icon">person</i>
            </div>
            
            <h2 class="user-name">{{ profil.prenom }} {{ profil.nom }}</h2>
            <p class="user-role">{{ profil.role || 'ADMINISTRATEUR' }}</p>
            
            <div class="separator"></div>

            <p class="member-since" *ngIf="profil.dateCreation">Membre depuis le {{ profil.dateCreation | date:'dd/MM/yyyy' }}</p>
        </div>

        <!-- Carte Droite : Formulaire -->
        <div class="details-card">
            
            <!-- Section 1: Information Personnelle -->
            <div class="section-container">
                <div class="section-header">
                    <i class="material-icons info-icon">person</i>
                    <h3 class="section-title">Information Personnelle</h3>
                </div>
                
                <form class="form-grid">
                    <!-- Nom -->
                    <div class="form-group">
                        <label>Nom</label>
                        <input type="text" [(ngModel)]="profil.nom" name="lastName" [disabled]="!isEditing" class="input-field" placeholder="Nom">
                    </div>
                    <!-- Prénom -->
                    <div class="form-group">
                        <label>Prénom</label>
                        <input type="text" [(ngModel)]="profil.prenom" name="firstName" [disabled]="!isEditing" class="input-field" placeholder="Prénom">
                    </div>
                    <!-- Email -->
                    <div class="form-group wide-group">
                        <label>Email</label>
                        <input type="email" [(ngModel)]="profil.email" name="email" [disabled]="!isEditing" class="input-field" placeholder="Email">
                    </div>
                </form>
            </div>

            <div class="security-section-divider"></div>
            
            <!-- Section 2: Sécurité -->
            <div class="section-container">
                <div class="section-header">
                    <i class="material-icons security-icon">shield</i>
                    <h3 class="section-title security-title">Sécurité</h3>
                </div>
                
                <form class="security-form" (submit)="saveProfile()">
                    
                    <!-- Mot de passe actuel (OBLIGATOIRE pour changer le mot de passe) -->
                    <div class="form-group wide-group" *ngIf="isEditing">
                        <label>Mot de passe actuel <span class="required-star">*</span></label>
                        <div class="password-input-wrapper input-field">
                            <!-- autocomplete="new-password" empêche le navigateur de pré-remplir ce champ -->
                            <input 
                                [type]="showPassword ? 'text' : 'password'" 
                                [(ngModel)]="passwordForm.currentPassword" 
                                name="currentPassword" 
                                [disabled]="!isEditing"
                                placeholder="Saisissez votre mot de passe actuel"
                                autocomplete="new-password"
                            >
                        
                        </div>
                    </div>

                    <!-- Nouveaux mots de passe -->
                    <div class="form-grid" *ngIf="isEditing">
                        <div class="form-group">
                            <label>Nouveau mot de passe</label>
                            <input 
                                type="password" 
                                [(ngModel)]="passwordForm.newPassword" 
                                name="newPassword" 
                                [disabled]="!isEditing" 
                                class="input-field" 
                                placeholder="Nouveau mot de passe"
                                autocomplete="new-password"
                            >
                        </div>
                        <div class="form-group">
                            <label>Confirmer mot de passe</label>
                            <input 
                                type="password" 
                                [(ngModel)]="passwordForm.confirmPassword" 
                                name="confirmPassword" 
                                [disabled]="!isEditing" 
                                class="input-field" 
                                placeholder="Confirmer mot de passe"
                                autocomplete="new-password"
                            >
                        </div>
                    </div>
                    
                    <p *ngIf="!isEditing" style="color: gray; font-style: italic; margin-top: 10px; font-size: 0.9rem;">
                        Cliquez sur "Modifier le profil" pour changer vos informations ou votre mot de passe.
                    </p>
                </form>
            </div>

            <!-- Boutons d'action -->
            <div class="action-buttons">
                <button *ngIf="isEditing" class="btn btn-cancel" (click)="toggleEditMode(false)" [disabled]="isLoading">Annuler</button>
                
                <button *ngIf="isEditing" class="btn btn-save" (click)="saveProfile()" [disabled]="isLoading">
                    {{ isLoading ? 'Enregistrement...' : 'Enregistrer' }}
                </button>

                <button *ngIf="!isEditing" class="btn btn-save" (click)="toggleEditMode(true)">Modifier le profil</button>
            </div>
        </div>
    </div>
</div>